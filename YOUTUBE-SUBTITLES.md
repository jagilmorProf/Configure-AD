Hey guys, in this video, we're going to install Active Directory through Microsoft Azure. We'll have one machine set up as the Windows server to host the Active Directory, and then we'll have a second machine connected to the Active Directory through a shared domain. We will kick things off by creating a Resource Group that we'll be using for both of the virtual machines. I'm just going to call it JG RG1.

Next, what I want to do is create my first domain controller. I'll call it GG DC1. The image that we're going to use here is going to be Windows Server 2019. I will note here that we want to maintain the same region between the two virtual machines, US East, and the Zone Zone one, just going to keep that the same. And with the virtual CPUs, I just want to keep it to two virtual CPUs, even though it's going to run fairly slow with a free version of Microsoft Azure. I'm limited to four total virtual CPUs, so between the two virtual machines, I'm going to split it two and two.

After creating my username and password, I'm going to take a look at our networking. We have to have the same VNet between the two virtual machines. I'm going to create it here with this first domain controller, and I'll use the same virtual network on the client one.

Now, I want to jump back into my DC JG1 virtual machine, and we're going to take a look at the virtual network that was created. We'll see that it's DC JG1 VNet, and we'll be using that as we create our second virtual machine. So let's go ahead and create our second virtual machine. We'll use the same Resource Group as before. We're going to call our virtual machine J Client One, and we're going to use Windows 10 Pro as our image. We're going to use two virtual CPUs. I want to use the username JagilmorLab4, and we can use password one.

Now, we're going to jump into the networking and focus on the fact that our virtual network is DC JG1. Just going to make sure that it's the same shared virtual network as our primary domain controller. And now that our virtual network is established, we can go ahead and create the rest of the virtual machine. It will take a little bit of time to create and deploy, so we'll fast forward through that.

Now we can jump into our first domain controller. While our other virtual machine is creating, I want to jump into the networking, and I want to change the IP configuration of this domain controller to be a static IP. As it's an Active Directory host, I don't want the primary private IP address ever to change, so we'll switch it from Dynamic to static.

So now, what we can finally do is connect to our first domain controller. I'm going to jump into the Azure portal into my DC JG1 and find my public IP address as well as my username and password, and then we can finally remote desktop to connect into our primary domain controller. And as we connect to the remote desktop connection for the first time, it's going to take a little bit of time for the virtual machine to load for the first time, so I'll go ahead and fast forward.

Alright, now that we're finally logged into our first domain controller, we can check back in on the Azure portal and see if our second virtual machine has deployed properly. We're going to overview, just make sure that we're in the same location, and we will double-check to make sure that the VNets all ended up on the same.

Alright, so now we can see here in the location we're both on the East US. I'm going to open up JG Client One and just make sure that the VNet matches with my domain controller, and we're both on DC JG1, so everything's working perfectly.

So the next thing I want to do is note that my domain controller private IP address is 10.0.0.4. We will use this in a ping connection here after we remote connect into JG Client One. I'm going to look at my username and password here shortly, and oftentimes it says that the VM agent is not available, but I'm going to go ahead and try to connect anyway, and yeah, it looks like it's going to let me in.

So, as we connected the Client One machine, I'm going to go back to my domain controller, run a couple of commands, 'whoami' as well as 'ipconfig', just to kind of double-check, make sure we're online correctly. And now we're going to wait a little bit for the Client One to finish loading, and afterwards on Client One, we want to pull up the command line interface and let's go ahead and run the command 'ping 10.0.0.4'. We want to check the communication between the domain controller and the Client One machine, and we can see that it's already timing out. So what we're going to have to do is jump into DC1 and we'll run the Windows command 'WF MSC' and this will open up the Windows Firewall. We're going to go to our inbound rules and filter by ICMP and we're going to find the file and print sharing Echo request and we will enable the rule. So after the rule has been enabled, we can now go back to our Client One and ping the domain controller again by going 'ping 10.0.0.4', and now we can see continuous replies from our domain controller.

Now that we've established a relationship between the two machines, what we're going to do is configure our active directory on DC1. We're going to go into manage AD roles and features and just next through most of these. We're going to make sure that our server roles have the Active Directory Domain Services installed, then we're just going to 'next' through the rest. It's going to take quite a bit of time in the virtual machine, but we'll fast forward. So in real-time, this is going to take maybe around 10 minutes to fully install. Luckily in this demonstration, I'll just fast forward through it.

So, after the installation happens, we can go ahead and promote this to a domain controller by adding a new forest. We're going to use the domain 'jagilmor.com' in this demonstration. So after we choose the root domain name, we'll create a restore mode password. I'm just going to create a password one for this, and we can go ahead and 'next' all the way through the rest of the configuration. And as usual, it's going to take a little bit of time for it to finish out, so we'll fast forward through it. It's going to sign us out, so we're going to have to log back into our domain. However, we cannot use the JagilmorLab4 as a primary username; we have to include the jagilmor.com domain in front of our username, and then we can log in with our password.

And now after we've logged in, it's going to be the first time after we've installed all the features, so it's going to take a little bit of time just for everything to kind of settle in. Now that everything is loaded, we can now go into our Active Directory and start controlling our users. We're going to add a couple of organizational units called '_employees' as well as '_admins'. This will help us manage the amount of users that we have and the permissions that should be allocated to each one of the tiers of employees.

So what I want to do next is refresh the list, make sure the hierarchy is set up in the correct order. I want to create a new user called 'Gilmore Zilla'. We're going to use first name 'Gilmore', last name 'Z'. So we've got the username 'GilmoreZilla', we're going to set the password as 'password one', and we're going to uncheck the need to change the password upon logging in.

So our next goal is to be able to log in with this new user. I have to set up the access by doing this. I go into remote desktop configuration, and I'm going to add all domain users to have access. What I need to do now is to add Gilmore Zilla into the domain. It's currently a domain user; I just want to promote myself to a domain admin. So now Gilmore Zilla has access to log into the domain controller as an admin. I can proceed to log out and log in with Gilmore Zilla, and run the normal configuration the same as if I were JagilmorLab4 from the beginning.

So you'll see I'm presenting here as JagilmorLab4, and then I'm going to sign off and sign in with Gilmore Zilla. We'll grab our public IP address just to make sure that we're going to log into the correct virtual machine. I'm going to change the username just to make sure that it's trying to log in with the jagilmor.com domain name, and then we're going to use the Gilmore Zilla username. It's going to load for the very first time for this user, so it's going to create the profile. And then what we can do is look at the 'whoami'. It's going to show Gilmore Zilla on the jagilmor.com domain.

So next, what I want to do is create a second user within my Active Directory. We're going to call it Jaro Saurus, and instead of logging into the domain controller with this user, we're going to log into Client One with the user that we've created within the domain controller. We'll do first name Jared, last name Saurus, user login name Jaro Saurus. We're going to do password one, and then we're going to uncheck 'user must change password at next login'. Now what I want to do is go through the properties and make sure that Jaro Saurus is a member of the domain admins.

So we'll go ahead and minimize our domain controller virtual machine and go ahead and log into JG Client One. Our next objective for this practice is to log in with Jaro Saurus on Client One. However, we need to set up the remote desktop configuration on Client One, as well as the DNS server that shares the same DNS server as DC JG1. So we'll go ahead and log in with JagilmorLab4, and then our next goals are to set up the remote desktop connection for any new users that are in this domain. However, we need to set up the domain first and foremost. So what we're going to have to do is jump into the Azure portal, go to Virtual Machines, I'm going to go to Client One, and go to the DNS server. And what we'll need to do is to find the DNS server that is on DC1, which is going to be the private IP address. So we're going to copy and paste that into the DNS server configuration for Client One, and then what we'll have to do is actually restart Client One so that the DNS server reflects. We'll go ahead and hit save, and the network interface card will take a little bit of time to actually update.

So now that we've finally restarted the machine, as well as updated the network interface, we should be able to properly configure the Client One machine to have the appropriate DNS server, as well as configure the remote connection for future users. So what we'll do here to start, we'll just double-check our DNS server on our Client One and see our 10.0.0.4. So now we can proceed to the next step. What we'll have to do is establish the domain name jagilmor.com, now that it's under the shared DNS server. Log in with Jaro Saurus using my password one. After we've established the domain, we can configure the remote desktop to actually include Jaro Saurus or all domain users to be able to log into Client One. So we're going to go ahead and finish up here with the configuration of the domain and remote desktop, and then we're going to reconnect to the Client One. We'll set up the connection with Client One with our domain jagilmor.com and our username Jaro Saurus. We have to remember to use the login configuration of jagilmor.com domain and then Jaro Saurus. So now we're able to connect to our Jaro Saurus username that we created in Active Directory on DC1, and now we can run the Windows command 'whoami' just to kind of identify that we're Jaro Saurus in this login.

Alright, so the next activity we're going to do is somewhat fun, and that is we're going to create a batch of users. This is derived from Josh Maor's PowerShell script that he had initially created, which creates a batch of 100, a thousand, and ten thousand users with just miscellaneous names. So we'll jump into my GitHub, github.com/JagilmorProf, and go into the Active Directory PowerShell commands. So I'll have a file called PS50W.PS1. It's going to basically be a PowerShell command that creates 50 users with a bunch of World of Warcraft characters. Big World of Warcraft player here. It's going to create a default password of password one, it's going to use a jagilmor.com domain, and various other configurations listed here on this script.

So here in the DC1, we're going to open up the PowerShell ISE, and we're going to make sure that we're running as the administrator. So we'll go ahead and copy this script in GitHub, and then we'll jump back into DC1. We can dock some screens around, but we want to go back into our Active Directory users and kind of look at the jagilmor.com directory since that's going to be the focus of this script that we're going to use. We can note that we have the admins and employees folders that we created earlier, but this script is going to create an additional folder called '_wow'. So after executing that script, you'll see there's a bunch of errors. It seems like there's a little bit of overlap when it runs a script, but in the end, it does end up making, I would guess, around 25 usernames. Had I run the script again, it probably would do the full amount. But if we go back into the Active Directory users, we can refresh the list and see all the new users in the W directory.

So if we open up any one of these users, we can see that the access privileges that they have is just as a domain user. Now what I want to do next is pick any one user from this list. Let's call it Ragnaros, and connect to that user account on our Client One machine. So we've got username name jagilmor.com back Ragnaros, password one. The script did password one for everybody, and we're going to try and log in. Looks like I spelled password wrong, then we push it through, and there we have it, the Ragnaros login works. After logging in for the first time, it's going to take a minute. Then we can run another Windows command 'whoami'. We've got jagilmor.com domain and Ragnaros user.

Now I'm going to log off, and we're going to try a new user, but we're going to lock ourselves out purposely. So what I'm going to do is remote desktop connect into Client One again but use the username Onyxia, and we will now deliberately spell the password incorrectly multiple times. We'll try time and time again, and we'll kind of see that there's really no lockout happening. In my opinion, this is a problem, and we should fix that.

So what we want to do to fix this is we're going to go into the Group Policy Management and edit the policy so that the login attempts are not set at zero, which is infinite, to just four failed login attempts. So what we'll do is we'll type in 'gpmc.msc' to open up the Group Policy Management, and we can open up our forest domain jagilmor.com and edit the default domain settings. We'll go ahead and expand policies, Windows settings, security settings, account policies, and then we're going to look at the Account Lockout Policy, and then what we'll do is just change the account lockout threshold from 0 to 4. After we've administered those settings, we want to force the update by going to our Windows command prompt, typing in 'gpupdate /force'. After forcing the Group Policy update, we can go back to our Group Policy Management tool and refresh our domain, and we can see the reflected change from zero login attempts lockout to four login attempts.

So now we're going to try to log back into our Client One machine with the username Onyxia, and then we're going to force two incorrect passwords, and we're going to see as a security precaution that the user account was locked out. So to fix the user lockout, we're going to log back into our domain controller Active Directory and just change the setting from locked out to being able to log back in again. So we'll go back to our Active Directory users and computers, jump into the jagilmor.com domain under organizational unit, and then we'll look at the Onyxia user. We'll go to the account tab and just check the box 'unlock account' so that we can log back in again.

So we'll log back into our Client One machine with the username Onyxia, and we'll see here that we are properly able to log in with the correct password. And that concludes today's video. Thanks for sticking around. Have a good one.
